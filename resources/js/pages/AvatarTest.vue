<template>
  <div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
          <h1 class="text-2xl font-bold text-gray-900">é ­åƒç³»çµ±æ¸¬è©¦é é¢</h1>
          <p class="mt-2 text-sm text-gray-600">
            å±•ç¤ºå„ç¨®é¡å‹çš„é ­åƒé…ç½®èˆ‡é¡¯ç¤ºæ•ˆæœ
          </p>
        </div>

        <div class="p-6 space-y-8">
          
          <!-- è¼‰å…¥ç‹€æ…‹ -->
          <div v-if="loading" class="flex justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
          </div>

          <!-- ç”¨æˆ¶é ­åƒ -->
          <div v-else>
            <section class="space-y-4">
              <h2 class="text-xl font-semibold text-gray-900">ç”¨æˆ¶é ­åƒ</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div 
                  v-for="user in users" 
                  :key="user.id"
                  class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg"
                >
                  <div class="flex space-x-2">
                    <IconDisplay 
                      :icon-data="user.avatar_data" 
                      size="xs" 
                      :title="user.full_name"
                    />
                    <IconDisplay 
                      :icon-data="user.avatar_data" 
                      size="sm" 
                      :title="user.full_name"
                    />
                    <IconDisplay 
                      :icon-data="user.avatar_data" 
                      size="md" 
                      :title="user.full_name"
                    />
                    <IconDisplay 
                      :icon-data="user.avatar_data" 
                      size="lg" 
                      :title="user.full_name"
                    />
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      {{ user.full_name }}
                    </p>
                    <p class="text-xs text-gray-500 truncate">
                      {{ getAvatarTypeDescription(user.avatar_data) }}
                    </p>
                  </div>
                </div>
              </div>
            </section>

            <!-- çµ„ç¹”é ­åƒ -->
            <section class="space-y-4">
              <h2 class="text-xl font-semibold text-gray-900">çµ„ç¹”é ­åƒ</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div 
                  v-for="org in organizations" 
                  :key="org.id"
                  class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg"
                >
                  <div class="flex space-x-2">
                    <IconDisplay 
                      :icon-data="org.avatar_data" 
                      size="sm" 
                      :title="org.name"
                    />
                    <IconDisplay 
                      :icon-data="org.avatar_data" 
                      size="md" 
                      :title="org.name"
                    />
                    <IconDisplay 
                      :icon-data="org.avatar_data" 
                      size="lg" 
                      :title="org.name"
                    />
                    <IconDisplay 
                      :icon-data="org.avatar_data" 
                      size="xl" 
                      :title="org.name"
                    />
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      {{ org.name }}
                    </p>
                    <p class="text-xs text-gray-500 truncate">
                      {{ getAvatarTypeDescription(org.avatar_data) }}
                    </p>
                  </div>
                </div>
              </div>
            </section>

            <!-- åœ˜éšŠé ­åƒ -->
            <section class="space-y-4">
              <h2 class="text-xl font-semibold text-gray-900">åœ˜éšŠé ­åƒ</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div 
                  v-for="team in teams" 
                  :key="team.id"
                  class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg"
                >
                  <div class="flex space-x-2">
                    <IconDisplay 
                      :icon-data="team.avatar_data" 
                      size="sm" 
                      :title="team.name"
                    />
                    <IconDisplay 
                      :icon-data="team.avatar_data" 
                      size="md" 
                      :title="team.name"
                    />
                    <IconDisplay 
                      :icon-data="team.avatar_data" 
                      size="lg" 
                      :title="team.name"
                    />
                    <IconDisplay 
                      :icon-data="team.avatar_data" 
                      size="xl" 
                      :title="team.name"
                    />
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      {{ team.name }}
                    </p>
                    <p class="text-xs text-gray-500 truncate">
                      {{ getAvatarTypeDescription(team.avatar_data) }}
                    </p>
                  </div>
                </div>
              </div>
            </section>

            <!-- é ­åƒé¡å‹ç¤ºä¾‹ -->
            <section class="space-y-4">
              <h2 class="text-xl font-semibold text-gray-900">é ­åƒé¡å‹ç¤ºä¾‹</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div 
                  v-for="(example, key) in avatarExamples" 
                  :key="key"
                  class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg"
                >
                  <IconDisplay 
                    :icon-data="example.data" 
                    size="lg" 
                    :title="example.name"
                  />
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900">
                      {{ example.name }}
                    </p>
                    <p class="text-xs text-gray-500">
                      {{ example.description }}
                    </p>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import IconDisplay from '@/components/common/IconDisplay.vue'
import axios from 'axios'

export default {
  name: 'AvatarTest',
  components: {
    IconDisplay
  },
  setup() {
    const loading = ref(true)
    const users = ref([])
    const organizations = ref([])
    const teams = ref([])
    const router = useRouter()
    
    // é ­åƒé¡å‹ç¤ºä¾‹
    const avatarExamples = {
      default_user: {
        name: 'é è¨­ç”¨æˆ¶é ­åƒ',
        description: 'åå­—ç¬¬ä¸€å­—æ¯ + éš¨æ©Ÿæ·¡è‰²èƒŒæ™¯',
        data: { type: 'text', text: 'æ¸¬', backgroundColor: '#f0fdf4', textColor: '#374151' }
      },
      custom_text: {
        name: 'è‡ªè¨‚æ–‡å­—é ­åƒ',
        description: 'è‡ªè¨‚æ–‡å­— + è‡ªè¨‚é¡è‰²',
        data: { type: 'text', text: 'ç‹', backgroundColor: '#f0fdf4', textColor: '#059669' }
      },
      emoji_simple: {
        name: 'Emoji é ­åƒ',
        description: 'ç°¡å–® Emoji + èƒŒæ™¯è‰²',
        data: { type: 'emoji', emoji: 'ğŸ˜€', backgroundColor: '#fef2f2' }
      },
      emoji_skin: {
        name: 'Emoji è†šè‰²é ­åƒ',
        description: 'Emoji + è†šè‰²ä¿®é£¾ç¬¦',
        data: { type: 'emoji', emoji: 'ğŸ‘‹ğŸ»', backgroundColor: '#fff7ed' }
      },
      hero_outline: {
        name: 'Hero Icon Outline',
        description: 'Hero Icons ç·šæ¢æ¨£å¼',
        data: { type: 'hero_icon', icon: 'user', backgroundColor: '#f0f9ff', iconColor: '#0ea5e9', style: 'outline' }
      },
      hero_solid: {
        name: 'Hero Icon Solid',
        description: 'Hero Icons å¯¦å¿ƒæ¨£å¼',
        data: { type: 'hero_icon', icon: 'heart', backgroundColor: '#fdf2f8', iconColor: '#ec4899', style: 'solid' }
      },
      bs_outline: {
        name: 'Bootstrap Icon Outline',
        description: 'Bootstrap Icons ç·šæ¢æ¨£å¼',
        data: { type: 'bootstrap_icon', icon: 'star', backgroundColor: '#fffbeb', iconColor: '#f59e0b', style: 'outline' }
      },
      bs_fill: {
        name: 'Bootstrap Icon Fill',
        description: 'Bootstrap Icons å¡«å……æ¨£å¼',
        data: { type: 'bootstrap_icon', icon: 'lightning', backgroundColor: '#f7fee7', iconColor: '#84cc16', style: 'fill' }
      },
      default_org: {
        name: 'é è¨­çµ„ç¹”é ­åƒ',
        description: 'æ·¡ç´«èƒŒæ™¯ + ç´«è‰²å»ºç¯‰åœ–æ¨™',
        data: { type: 'bootstrap_icon', icon: 'building', backgroundColor: '#faf5ff', iconColor: '#a855f7', style: 'fill' }
      },
      default_team: {
        name: 'é è¨­åœ˜éšŠé ­åƒ',
        description: 'æ·¡è—èƒŒæ™¯ + è—è‰²åœ˜éšŠåœ–æ¨™',
        data: { type: 'bootstrap_icon', icon: 'people', backgroundColor: '#eff6ff', iconColor: '#3b82f6', style: 'fill' }
      }
    }
    
    const loadData = async () => {
      try {
        loading.value = true
        
        // è¼‰å…¥æ¸¬è©¦ç”¨æˆ¶
        const usersResponse = await axios.get('/api/admin/users', {
          params: { search: 'test', per_page: 20 }
        })
        users.value = usersResponse.data.data
        
        // è¼‰å…¥æ¸¬è©¦çµ„ç¹”
        const orgsResponse = await axios.get('/api/admin/organizations', {
          params: { search: 'æ¸¬è©¦çµ„ç¹”', per_page: 20 }
        })
        organizations.value = orgsResponse.data.data
        
        // è¼‰å…¥æ¸¬è©¦åœ˜éšŠ (é€éçµ„ç¹”)
        if (organizations.value.length > 0) {
          for (const org of organizations.value) {
            const teamsResponse = await axios.get(`/api/organizations/${org.id}/teams`)
            teams.value.push(...teamsResponse.data.data)
          }
        }
        
      } catch (error) {
        console.error('è¼‰å…¥æ¸¬è©¦è³‡æ–™å¤±æ•—:', error)
        if (error.response?.status === 401) {
          router.push('/login')
        }
      } finally {
        loading.value = false
      }
    }
    
    const getAvatarTypeDescription = (avatarData) => {
      if (!avatarData) return 'ç„¡é ­åƒæ•¸æ“š'
      
      switch (avatarData.type) {
        case 'text':
          return `æ–‡å­—: "${avatarData.text}"`
        case 'emoji':
          return `Emoji: ${avatarData.emoji}`
        case 'hero_icon':
          return `Hero Icon: ${avatarData.icon} (${avatarData.style})`
        case 'bootstrap_icon':
          return `Bootstrap Icon: ${avatarData.icon} (${avatarData.style})`
        case 'image':
          return `åœ–ç‰‡: ${avatarData.path || avatarData.url}`
        default:
          return 'æœªçŸ¥é¡å‹'
      }
    }
    
    onMounted(() => {
      loadData()
    })
    
    return {
      loading,
      users,
      organizations,
      teams,
      avatarExamples,
      getAvatarTypeDescription
    }
  }
}
</script>